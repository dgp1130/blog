{% import "fragments/card.njk" as card %}
{% import "fragments/favicon.njk" as favicon %}
{% import "fragments/footer.njk" as footer %}
{% import "fragments/header.njk" as header %}

{#
    For some unknown reason, by putting a `block` inside a `set`, that block is
    now **required** and will throw an error if not provided. There seems to be
    no way to use an optional `block` inside a `set`, which is quite limiting.
    However, it does provide a means of requiring specific blocks where this
    template is used.
#}
{% set title %}
    {% filter oneline %}
        {% block title %}{% endblock %}
    {% endfilter %}
{% endset %}
{% set desc %}
    {% filter oneline %}
        {% block description %}{% endblock %}
    {% endfilter %}
{% endset %}
{% set scripts %}
    {% block scripts %}{% endblock %}
{% endset %}
{% set styles %}
    {% block styles %}{% endblock %}
{% endset %}
{% set content %}
    {% block content %}{% endblock %}
{% endset %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{{ title }}</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="{{ desc }}">

        {# Twitter meta tags to render nicely in a card. #}
        <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@{{ author.twitter_username }}">
        <meta name="twitter:creator" content="@{{ author.twitter_username }}">
        <meta name="twitter:title" content="{{ title }}">
        <meta name="twitter:description" content="{{ desc }}">
        {# Note: image must meet a few requirements to be valid:
           https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/markup #}
        <meta name="twitter:image" content="https://blog.dwac.dev/res/img/profile.webp">
        <meta name="twitter:image:alt" content="Headshot of author wearing a Noogler hat, googley-eyed glasses, and a Google t-shirt.">

        <link rel="preload" href="/res/fonts/lora/latin.woff2" as="font"
            crossorigin="anonymous">
        {{ favicon.favicon() }}

        <style>{{ styles | trim | css | safe }}</style>

        {% block head %}{% endblock %}

        {% for script in scripts | trim | split('\n') %}
            <script src="{{ script | trim }}" async defer></script>
        {% endfor %}
    </head>
    <body>
        {{ header.header(class="header") }}

        <main class="base-content">
            {{ content | safe }}
        </main>

        {{ footer.footer(author, repo, page.inputPath, class="base-footer") }}
    </body>
</html>
